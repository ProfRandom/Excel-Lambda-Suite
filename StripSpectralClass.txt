/* NUMNOTE_NUM_ONLY
   Purpose:
   Extracts only the numeric portion (digits and decimal point) from a text string.

   Returns:
   - A numeric value if the input string contains only one decimal point.
   - A numeric-looking string if multiple decimals are found (to avoid Excel errors).
   - "#NONE!" if no valid digits are detected.

   Use Cases:
   - Cleaning scraped data where symbols, letters, or units are embedded (e.g., "$12.50", "abc123.45kg").
   - Extracting numbers from messy user inputs without triggering Excel conversion errors.

   Parameters:
   - input (required): A text string possibly containing numeric and non-numeric characters.

   Notes:
   - Retains only ASCII digits (`0–9`) and a single decimal point.
   - If the result includes multiple decimal points, it returns the output as a string to avoid Excel conversion failure.
   - Useful for lightweight numeric sanitization or debugging preprocessing steps.
*/

NUMNOTE_NUM_ONLY = LAMBDA(input,
    LET(
        // Convert each character in the input string to its ASCII code
        get_codes, CODE(MID(LOWER(input), SEQUENCE(LEN(input)), 1)),

        // Count how many decimal points (ASCII 46) appear in the input
        make_num, SUM(--BYROW(get_codes, LAMBDA(z, z = 46))),

        // Extract only digits (ASCII 48–57) and a period (ASCII 46)
        filtered, CONCAT(BYROW(get_codes, LAMBDA(x, IF(AND(OR(x < 48, x > 57), x <> 46), "", CHAR(x))))),

        // Output logic:
        // - If more than one decimal: return string version of filtered
        // - If exactly one or zero decimal: attempt to convert to a number
        output, IF(
            make_num >= 2,
            filtered,
            IFERROR(VALUE(filtered), "#NONE!")
        ),

        output
    )
);
