STAR_CLASS_STATS = LAMBDA(in, [precision],
    LET(
        input, SUBSTITUTE(in, " ", ""),
        precision, IF(ISOMITTED(precision), 6, precision),
        class, LEFT(input, 1),
        sub, RIGHT(input, LEN(input) - 1),
        thresholds, {55000, 25000, 10000, 7500, 6000, 5000, 3500, 2400, 1300, 600},
        classifications, {"O", "B", "A", "F", "G", "K", "M", "L", "T", "Y"},
        q_vals, {3000, 1500, 250, 150, 100, 150, 110, 110, 70, 30},
        max_temp, XLOOKUP(class, classifications, thresholds),
        q_factor, XLOOKUP(class, classifications, q_vals),
        k_temp, max_temp - (sub * q_factor),
        temp, k_temp / 5800,
        kelvin, "K: " & ROUND(k_temp, precision),
        solar, "T: " & ROUND(temp, precision),
        radius, "R: " & ROUND(temp ^ 1.8, precision),
        luminosity, "L: " & ROUND(temp ^ 7.5778, precision),
        mass, "M: " & ROUND(temp ^ 2, precision),
        lifetime, "V: " & ROUND(temp ^ -5, precision),
        list, TEXTJOIN("|", , "-> " & input, kelvin, solar, mass, radius, luminosity, lifetime),
        TOCOL(TEXTSPLIT(list, "|"))
    )
);


/* STAR_SCALE_TEMP

Returns star attributes calculated from solar temp
*/
STAR_SCALE_TEMP = LAMBDA(temp, [precision],
    LET(
        precision, IF(ISOMITTED(precision), 6, precision),
        t_temp, "T-> " & ROUND(temp, precision),
        kelvin, "K: " & ROUND(temp * 5800, precision),
        radius, "R: " & ROUND(temp ^ 1.8, precision),
        luminosity, "L: " & ROUND(temp ^ 7.5778, precision),
        mass, "M: " & ROUND(temp ^ 2, precision),
        lifetime, "V: " & ROUND(temp ^ -5, precision),
        list, TEXTJOIN("|", , kelvin, t_temp, mass, radius, luminosity, lifetime),
        TOCOL(TEXTSPLIT(list, "|"))
    )
);

STAR_SCALE_KTEMP = LAMBDA(kelvin, [precision],
    LET(
        precision, IF(ISOMITTED(precision), 6, precision),
        k_temp, "K-> " & ROUND(kelvin, precision),
        temp, kelvin / 5800,
        solar, "T: " & ROUND(temp, precision),
        radius, "R: " & ROUND(temp ^ 1.8, precision),
        luminosity, "L: " & ROUND(temp ^ 7.5778, precision),
        mass, "M: " & ROUND(temp ^ 2, precision),
        lifetime, "V: " & ROUND(temp ^ -5, precision),
        list, TEXTJOIN("|", , k_temp, solar, mass, radius, luminosity, lifetime),
        TOCOL(TEXTSPLIT(list, "|"))
    )
);

STAR_MASS = LAMBDA(mass, [precision],
    LET(
        precision, IF(ISOMITTED(precision), 6, precision),
        s_mass, "M-> " & ROUND(mass, precision),
        temperature, "T: " & ROUND(SQRT(mass), precision),
        solar, SQRT(mass) * 5800,
        kelvin, "K: " & ROUND(solar, precision),
        radius, "R: " & ROUND(mass ^ 0.9, precision),
        luminosity, "L: " & ROUND(mass ^ 3.7889, precision),
        lifetime, "V: " & ROUND(SQRT(mass) ^ -5, precision),
        list, TEXTJOIN("|", , kelvin, temperature, s_mass, radius, luminosity, lifetime),
        TOCOL(TEXTSPLIT(list, "|"))
    )
);


STAR_RADS = LAMBDA(radius, [precision],
    LET(
        precision, IF(ISOMITTED(precision), 6, precision),
        solar, "R-> " & ROUND(radius, precision),
        temperature, "T: " & ROUND(radius ^ (1 / 1.8), precision),
        kelvin, "K: " & ROUND((radius ^ (1 / 1.8)) * 5800, precision),
        luminosity, "L: " & ROUND(radius ^ 4.22, precision),
        mass, "M: " & ROUND(radius ^ 1.114270017777780, precision),
        lifetime, "V: " & ROUND(radius ^ (1 / -0.36), precision),
        list, TEXTJOIN("|", , kelvin, temperature, mass, solar, luminosity, lifetime),
        TOCOL(TEXTSPLIT(list, "|"))
    )
);


STAR_LUMS = LAMBDA(luminosity, [precision],
    LET(
        precision, IF(ISOMITTED(precision), 6, precision),
        temperature, "T: " & ROUND(luminosity ^ (1 / 7.6), precision),
        kelvin, "K: " & ROUND((luminosity ^ (1 / 7.5778)) * 5800, precision),
        s_lum, "L-> " & ROUND(luminosity, precision),
        radius, "R: " & ROUND(luminosity ^ (1 / 4.22), precision),
        mass, "M: " & ROUND(luminosity ^ (1 / 3.7889), precision),
        lifetime, "V: " & ROUND(luminosity ^ (1 / -1.52), precision),
        list, TEXTJOIN("|", , kelvin, temperature, mass, radius, s_lum, lifetime),
        TOCOL(TEXTSPLIT(list, "|"))
    )
);

STARLUMS = LAMBDA(luminosity, [precision],
    LET(
        precision, IF(ISOMITTED(precision), 6, precision),
        labels, TRANSPOSE({"K:", "T:", "M:", "R:", "L}", "V:"}),
        T, ROUND(luminosity ^ (1 / 7.5778), precision),
        K, ROUND((luminosity ^ (1 / 7.5778)) * 5800, precision),
        L, ROUND(luminosity, precision),
        R, ROUND(luminosity ^ (1 / 4.22), precision),
        M, ROUND(luminosity ^ (1 / 3.7889), precision),
        V, ROUND(luminosity ^ (1 / -1.52), precision),
        attribs, TEXTJOIN(",", , K, T, M, R, L, V),
        values, TRANSPOSE(TEXTSPLIT(attribs, ",")),
        CHOOSE({1, 2}, labels, values)
    )
);


STAR_LIFE = LAMBDA(lifetime, [precision],
    LET(
        precision, IF(ISOMITTED(precision), 6, precision),
        solar, "V-> " & ROUND(lifetime, precision),
        temperature, "T: " & ROUND(lifetime ^ (1 / -5), precision),
        kelvin, "K: " & ROUND((lifetime ^ (1 / -5)) * 5800, precision),
        radius, "R: " & ROUND(lifetime ^ (-0.36), precision),
        mass, "M: " & ROUND(lifetime ^ (1 / -2.5), precision),
        luminosity, "L: " & ROUND(lifetime ^ -1.52, precision),
        list, TEXTJOIN("|", , kelvin, temperature, mass, radius, luminosity, solar),
        TOCOL(TEXTSPLIT(list, "|"))
    )
);


TYPE_FROM_TEMP = LAMBDA(temp, [mode], [prec],
    LET(
        temp, ifs(temp<600,600,
                temp>55000,55000,
                TRUE, temp),
        mode, IF(OR(ISOMITTED(mode), mode > 1), 0, mode),
        prec, IF(OR(ISOMITTED(prec), prec < 0), 3, prec),
        thresholds, {55000, 25000, 10000, 7500, 6000, 5000, 3500, 2400, 1300, 600, 300},
        classifications, {"O", "B", "A", "F", "G", "K", "M", "L", "T", "Y"},
        q_vals, {3000, 1500, 250, 150, 100, 150, 110, 110, 70, 30},
        index, MATCH(TRUE, temp > thresholds, 0) - 1,
        s_type, INDEX(classifications, index),
        k_max, INDEX(thresholds, index),
        q_val, INDEX(q_vals, index),
        class_num, (k_max - temp) / q_val,
        s_class, IF(class_num = 10, 9.999, class_num),
        output, SWITCH(mode,
            0, s_type & " " & FIXED(s_class, prec),
            1, temp & " = " & s_type & FIXED(s_class, prec), ),
        output
    )
);

TEMP_FROM_TYPE = LAMBDA(in, [mode],
    LET(
        mode, IF(OR(ISOMITTED(mode), mode > 1), 0, mode),
        input, SUBSTITUTE(in, " ", ""),
        class, LEFT(input, 1),
        sub, RIGHT(input, LEN(input) - 1),
        thresholds, {55000, 25000, 10000, 7500, 6000, 5000, 3500, 2400, 1300, 600},
        classifications, {"O", "B", "A", "F", "G", "K", "M", "L", "T", "Y"},
        q_vals, {3000, 1500, 250, 150, 100, 150, 110, 110, 70, 30},
        max_temp, XLOOKUP(class, classifications, thresholds),
        q_factor, XLOOKUP(class, classifications, q_vals),
        k_temp, max_temp - (sub * q_factor),
        SWITCH(mode, 0, k_temp, 1, input & " = " & k_temp)
    )
);

SPECTRAL_CLASS_DATA = LAMBDA([null],
    LET(
        headers, {"Type"; "Min"; "Max"; "Span"; "q"},
        types, VSTACK(INDEX(headers, 1), {"O"; "B"; "A"; "F"; "G"; "K"; "M"; "L"; "T"; "Y"}),
        min, VSTACK(INDEX(headers, 2), {25000; 10000; 7500; 6000; 5000; 3500; 2400; 1300; 600; 300}),
        max, VSTACK(INDEX(headers, 3), {55000; 25000; 10000; 7500; 6000; 5000; 3500; 2400; 1300; 600}),
        q_vals, VSTACK(INDEX(headers, 5), {3000; 1500; 250; 150; 100; 150; 110; 110; 70; 30}),
        ranges, {30000; 15000; 2500; 1500; 1000; 1500; 1100; 1100; 700; 300},
        span, VSTACK(INDEX(headers, 4), ranges),
        CHOOSE({1, 2, 3, 4, 5}, types, min, max, span, q_vals)
    )
);